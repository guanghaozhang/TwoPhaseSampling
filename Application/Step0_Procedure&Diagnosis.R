#procedure data
#data clean: egrep -w '93784|93786|93788|93790|99473|99474|90791|90792|90832|90834|90837|90839|90845|90880|92002|92004|92012|92014|96118|99201|99202|99203|99204|99205|99212|99213|99214|99281|99282|99283|99284|99285|99215|99304|99305|99306|99307|99308|99309|99310|99318|99324|99325|99326|99327|99328|99334|99335|99336|99337|99340|99341|99342|99343|99344|99345|99347|99348|99349|99350|D7140|D7210|G0101|G0402|G0438|G0439' HPI_4605_Procedures.txt > prhp.txt
#read and clean data:
mgi0 <- read.table("prhp.txt", header = F, sep = "\t", fill = TRUE)
mgi1 <- mgi0[!mgi0$V3=="41899.1",]
mgi1 <- mgi1[!mgi1$V3=="41899.5",]
mgi1 <- mgi1[!mgi1$V3=="41899.6",]
mgi1 <- mgi1[!mgi1$V3=="G0447.1",]

mgi1 <- subset(mgi1, select = c(-V4, -V5, -V6))
colnames(mgi1) <- c("id", "age", "procedure")
mgi1 <- mgi1[order(mgi1$id, -abs(mgi1$age)), ]
mgi1 <- mgi1[!duplicated(mgi1$id), ]
dim(mgi1)
write.table(mgi1,"procedure.txt",sep="\t",row.names=FALSE)
#we have 81356 observations

#diagnosis data
#data clean: egrep -w 'I10|I11.0|I11.9|I12.0|I12.9|I13.0|I13.10|I13.11|I13.2|I15.0|I15.1|I15.2|I15.8|I15.9|401.0|401.1|401.9|402.00|402.01|402.10|402.11|402.90|402.91|403.00|403.01|403.10|403.11|403.90|403.91|404.00|404.01|404.02|404.03|404.10|404.11|404.12|404.13|404.90|404.91|404.92|404.93|405.01|405.09|405.11|405.19|405.91|405.99' HPI_4605_Diagnosis.txt > hpdg.txt
mgi0 <- read.table("hpdg.txt", header = F, sep = "\t", fill = TRUE)
mgi1 <- mgi0[!mgi0$V3=="136.8",]
mgi1 <- mgi1[!mgi1$V3=="160.0",]
mgi1 <- mgi1[!mgi1$V3=="173.62",]
mgi1 <- mgi1[!mgi1$V3=="193",]
mgi1 <- mgi1[!mgi1$V3=="216.4",]
mgi1 <- mgi1[!mgi1$V3=="216.5",]
mgi1 <- mgi1[!mgi1$V3=="216.7",]
mgi1 <- mgi1[!mgi1$V3=="228.00",]
mgi1 <- mgi1[!mgi1$V3=="252.1",]
mgi1 <- mgi1[!mgi1$V3=="252.9",]
mgi1 <- mgi1[!mgi1$V3=="275.42",]
mgi1 <- mgi1[!mgi1$V3=="282.40",]
mgi1 <- mgi1[!mgi1$V3=="444.09",]
mgi1 <- mgi1[!mgi1$V3=="512.84",]
mgi1 <- mgi1[!mgi1$V3=="516.31",]
mgi1 <- mgi1[!mgi1$V3=="519.02",]
mgi1 <- mgi1[!mgi1$V3=="516.31",]
mgi1 <- mgi1[!mgi1$V3=="576.8",]
mgi1 <- mgi1[!mgi1$V3=="599.69",]
mgi1 <- mgi1[!mgi1$V3=="646.70",]
mgi1 <- mgi1[!mgi1$V3=="658.20",]
mgi1 <- mgi1[!mgi1$V3=="704.41",]
mgi1 <- mgi1[!mgi1$V3=="747.31",]
mgi1 <- mgi1[!mgi1$V3=="793.11",]
mgi1 <- mgi1[!mgi1$V3=="790.3",]
mgi1 <- mgi1[!mgi1$V3=="795.79",]
mgi1 <- mgi1[!mgi1$V3=="919.7",]
mgi1 <- mgi1[!mgi1$V3=="704.41",]
mgi1 <- mgi1[!mgi1$V3=="997.49",]
mgi1 <- mgi1[!mgi1$V3=="999.49",]
mgi1 <- mgi1[!mgi1$V3=="B99.8",]
mgi1 <- mgi1[!mgi1$V3=="C30.0",]
mgi1 <- mgi1[!mgi1$V3=="C44.621",]
mgi1 <- mgi1[!mgi1$V3=="C73",]
mgi1 <- mgi1[!mgi1$V3=="D18.00",]
mgi1 <- mgi1[!mgi1$V3=="D22.70",]
mgi1 <- mgi1[!mgi1$V3=="D23.4",]
mgi1 <- mgi1[!mgi1$V3=="D23.5",]
mgi1 <- mgi1[!mgi1$V3=="D23.70",]
mgi1 <- mgi1[!mgi1$V3=="D36.7",]
mgi1 <- mgi1[!mgi1$V3=="D56.9",]
mgi1 <- mgi1[!mgi1$V3=="D68.62",]
mgi1 <- mgi1[!mgi1$V3=="E21.5",]
mgi1 <- mgi1[!mgi1$V3=="E83.52",]
mgi1 <- mgi1[!mgi1$V3=="E89.2",]
mgi1 <- mgi1[!mgi1$V3=="E947.9",]
mgi1 <- mgi1[!mgi1$V3=="I70.0",]
mgi1 <- mgi1[!mgi1$V3=="I74.09",]
mgi1 <- mgi1[!mgi1$V3=="J93.82",]
mgi1 <- mgi1[!mgi1$V3=="J84.112",]
mgi1 <- mgi1[!mgi1$V3=="J95.03",]
mgi1 <- mgi1[!mgi1$V3=="K56.7",]
mgi1 <- mgi1[!mgi1$V3=="K83.1",]
mgi1 <- mgi1[!mgi1$V3=="K91.3",]
mgi1 <- mgi1[!mgi1$V3=="K91.30",]
mgi1 <- mgi1[!mgi1$V3=="K91.89",]
mgi1 <- mgi1[!mgi1$V3=="L08.9",]
mgi1 <- mgi1[!mgi1$V3=="L72.11",]
mgi1 <- mgi1[!mgi1$V3=="N13.9",]
mgi1 <- mgi1[!mgi1$V3=="O09.70",]
mgi1 <- mgi1[!mgi1$V3=="O26.619",]
mgi1 <- mgi1[!mgi1$V3=="O42.119",]
mgi1 <- mgi1[!mgi1$V3=="Q25.6",]
mgi1 <- mgi1[!mgi1$V3=="R89.4",]
mgi1 <- mgi1[!mgi1$V3=="R91.1",]
mgi1 <- mgi1[!mgi1$V3=="T07",]
mgi1 <- mgi1[!mgi1$V3=="T80.59XA",]
mgi1 <- mgi1[!mgi1$V3=="V23.89",]
mgi1 <- mgi1[!mgi1$V3=="V45.00",]
mgi1 <- mgi1[!mgi1$V3=="V45.82",]
mgi1 <- mgi1[!mgi1$V3=="V70.7",]
mgi1 <- mgi1[!mgi1$V3=="V81.2",]
mgi1 <- mgi1[!mgi1$V3=="Y90.1",]
mgi1 <- mgi1[!mgi1$V3=="Z00.6",]
mgi1 <- mgi1[!mgi1$V3=="Z13.6",]
mgi1 <- mgi1[!mgi1$V3=="Z95.5",]
mgi1 <- mgi1[!mgi1$V3=="Z95.9",]

mgi1 <- subset(mgi1, select = c(V1, V2, V4))
colnames(mgi1) <- c("id", "age", "diagosis")
mgi1 <- mgi1[order(mgi1$id, -abs(mgi1$age)), ]
mgi1 <- mgi1[!duplicated(mgi1$id), ]
dim(mgi1)

write.table(mgi1,"diagnosis.txt",sep="\t",row.names=FALSE)